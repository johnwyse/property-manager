{% extends "property/layout.html" %}

{% block body %}

<h1>Issues</h1>

{% if user.is_authenticated %}

    {% if user == unit.manager or user == unit.tenant %}
    
        {% if user.tenant %}
        <button onclick="show_report_issue_form_block()" class="show_report_an_issue_form">Report an issue to {{unit.manager.first_name}}</button><br>
                    
        <div class="report_an_issue_form">
            <form action="{% url 'report_issue' %}" method="post">
                {% csrf_token %}
                <div class="upload_form">
                    <input class="issue_input" id="issue_title" name="title" autocomplete=off type=text placeholder="Title">
                    <br><br>
                    <textarea class="issue_input" id="issue_description" name="description" autocomplete=off type=text placeholder="Description" rows=4 cols=80></textarea>
                    <br><br>
                    <label for="image">Image (optional)</label>
                    <br>
                    <input id="add_image" name="image" type="file">
                </div>
                <input class="btn btn-warning" type="submit" value="Submit Issue">
            </form>
        </div>
        {% endif %}


        <div class="inline-child">
            <h2 id="unresolved_header">Unresolved Issues</h2>
            
            <div class="unresolved-issues">
            {% for issue in unresolved_issues %}
                <div class="unresolved-item">
                    <p>Issue: {{issue.title}}</p>
                    <p>Reported: {{issue.time_created}}</p>
                    <p>Description: {{issue.description}}</p>
                    {% if issue.image %} 
                    <img src="{{ issue.image.url }}" alt="{{ issue.title }}" height=200>
                    {% endif %}
                    {% if user.tenant %}
                    <form action="{% url 'change_resolved' issue.id %}" method="post">
                        {% csrf_token %}
                        <button class="btn btn-warning" id="resolve_button_{{issue.id}}">Mark as Resolved</button>
                    </form> 
                    {% endif %}
                </div>
            {% endfor %}
            </div>
        </div>

        <div class="inline-child">
            <h2 id="resolved_header">Resolved Issues</h2>

            <div class="resolved-issues">
            {% for issue in resolved_issues %}
                <div class="resolved-item">
                    <p>Issue: {{issue.title}}</p>
                    <p>Reported: {{issue.time_created}}</p>
                    <p>Description: {{issue.description}}</p>
                    {% if issue.image %} 
                    <img src="{{ issue.image.url }}" alt="{{ issue.title }}" height=200>
                    <br><br>
                    {% endif %}
                    {% if user.tenant %} 
                    <form action="{% url 'change_resolved' issue.id %}" method="post">
                        {% csrf_token %}
                        <button class="btn btn-warning" id="unresolve_button_{{issue.id}}">Mark as Unresolved</button>
                    </form> 
                    {% endif %}
                </div>
            
            {% endfor %}
            </div>
        </div>
    
    {% else %}
    <br><br>You don't have permission to view this page.
    {% endif %}

{% else %}
<br><br>You don't have permission to view this page.
{% endif %}

{% endblock %}